{"ast":null,"code":"var _jsxFileName = \"/home/stephen/Desktop/Taras web app/frontend-nextjs/components/Map.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { Component } from 'react';\nimport ReactMapGL, { Popup } from 'react-map-gl';\n\nclass Map extends Component {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"state\", {\n      viewport: {\n        width: '100vw',\n        height: '100vh',\n        latitude: 38.89628315907695,\n        longitude: -77.02367155674042,\n        zoom: 11\n      },\n      geojson: {},\n      showPopup: true\n    });\n  }\n\n  componentDidMount() {\n    const map = this.reactMap.getMap();\n    map.on('load', () => {\n      console.log(\"Starting to pull data!\");\n      this.pullNewData(0);\n    });\n    map.on('mouseenter', 'points', function (e) {\n      // Change the cursor style as a UI indicator.\n      map.getCanvas().style.cursor = 'pointer';\n    });\n  }\n\n  pullNewData(chunk) {\n    console.log(\"pulling more data...\");\n    let url = 'http://192.168.86.34:3001/crash/coordinates/geojson?chunk=' + chunk;\n    fetch(url).then(res => res.json()).then(data => this.displayDataOnMap(data.data, chunk));\n  }\n\n  displayDataOnMap(geojson, chunk) {\n    const map = this.reactMap.getMap(); // add initial chunk of data\n\n    if (chunk == 0) {\n      this.state.geojson = geojson;\n      map.addSource('crash-data', this.state.geojson);\n      map.addLayer({\n        'id': 'crash-heat',\n        'type': 'heatmap',\n        'source': 'crash-data'\n      });\n      map.addLayer({\n        'id': 'points',\n        'type': 'circle',\n        'source': 'crash-data',\n        'paint': {\n          // make circles larger as the user zooms from z12 to z22\n          'circle-radius': {\n            'base': 1.75,\n            'stops': [[2, 2], [22, 22]]\n          }\n        },\n        'layout': {}\n      });\n    } else {\n      if (geojson.data.features.length == 0) {\n        console.log(\"All crashes loaded in!\");\n        return;\n      }\n\n      Array.prototype.push.apply(this.state.geojson.data.features, geojson.data.features);\n      map.getSource('crash-data').setData(this.state.geojson.data);\n    }\n\n    this.pullNewData(chunk + 1);\n  }\n\n  _renderPopup() {\n    const {\n      popupInfo\n    } = this.state;\n    return popupInfo && __jsx(Popup, {\n      tipSize: 5,\n      anchor: \"top\",\n      longitude: popupInfo.longitude,\n      latitude: popupInfo.latitude,\n      closeOnClick: false,\n      onClose: () => this.setState({\n        popupInfo: null\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 9\n      }\n    }, __jsx(CityInfo, {\n      info: popupInfo,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 11\n      }\n    }));\n  }\n\n  render() {\n    const {\n      showPopup\n    } = this.state;\n    return __jsx(ReactMapGL, {\n      ref: reactMap => this.reactMap = reactMap,\n      mapStyle: \"mapbox://styles/mapbox/streets-v9\",\n      mapboxApiAccessToken: \"pk.eyJ1IjoieW9tYW40NyIsImEiOiJjampxM2g3YjUyMzFyM3ZvMXNjZ2R3d2ZtIn0.r0zXd8hAqa1haG3lkjlDwA\",\n      onViewportChange: viewport => this.setState({\n        viewport\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 7\n      }\n    }, this._renderPopup());\n  }\n\n}\n\nexport default Map;","map":{"version":3,"sources":["/home/stephen/Desktop/Taras web app/frontend-nextjs/components/Map.js"],"names":["Component","ReactMapGL","Popup","Map","viewport","width","height","latitude","longitude","zoom","geojson","showPopup","componentDidMount","map","reactMap","getMap","on","console","log","pullNewData","e","getCanvas","style","cursor","chunk","url","fetch","then","res","json","data","displayDataOnMap","state","addSource","addLayer","features","length","Array","prototype","push","apply","getSource","setData","_renderPopup","popupInfo","setState","render"],"mappings":"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","sourcesContent":["import { Component } from 'react';\nimport ReactMapGL, {Popup} from 'react-map-gl';\n\nclass Map extends Component {\n\n  state = {\n    viewport: {\n      width: '100vw',\n      height: '100vh',\n      latitude: 38.89628315907695,\n      longitude: -77.02367155674042,\n      zoom: 11,\n    },\n    geojson: {},\n    showPopup: true\n  };\n\n  componentDidMount() {\n    const map = this.reactMap.getMap(); \n\n    map.on('load', () => {\n      console.log(\"Starting to pull data!\")\n      this.pullNewData(0);\n  })\n\n    map.on('mouseenter', 'points', function(e) {\n      // Change the cursor style as a UI indicator.\n      map.getCanvas().style.cursor = 'pointer';\n    });\n    \n  }\n\n  pullNewData(chunk){\n\n    console.log(\"pulling more data...\");\n\n    let url = 'http://192.168.86.34:3001/crash/coordinates/geojson?chunk=' + chunk;\n\n      fetch(url)\n      .then(res => res.json())\n      .then(data => this.displayDataOnMap(data.data,chunk));\n\n  }\n\n  displayDataOnMap(geojson,chunk){\n\n    const map = this.reactMap.getMap(); \n\n    // add initial chunk of data\n    if(chunk == 0){\n\n      this.state.geojson = geojson;\n\n      map.addSource('crash-data',this.state.geojson)\n\n      map.addLayer(\n        {\n        'id': 'crash-heat',\n        'type': 'heatmap',\n        'source': 'crash-data',\n        });\n\n      map.addLayer({\n          'id': 'points',\n          'type': 'circle',\n          'source': 'crash-data',\n          'paint': {\n            // make circles larger as the user zooms from z12 to z22\n            'circle-radius': {\n            'base': 1.75,\n            'stops': [\n            [2, 2],\n            [22, 22]\n            ]\n            }},\n          'layout': {}});\n    } else {\n\n      if(geojson.data.features.length==0){\n        console.log(\"All crashes loaded in!\");\n        return;\n      }\n\n      Array.prototype.push.apply(this.state.geojson.data.features, geojson.data.features);\n\n      map.getSource('crash-data').setData(this.state.geojson.data)\n\n      \n    }\n\n    this.pullNewData(chunk+1);\n\n  }\n\n\n  _renderPopup() {\n    const {popupInfo} = this.state;\n\n    return (\n      popupInfo && (\n        <Popup\n          tipSize={5}\n          anchor=\"top\"\n          longitude={popupInfo.longitude}\n          latitude={popupInfo.latitude}\n          closeOnClick={false}\n          onClose={() => this.setState({popupInfo: null})}\n        >\n          <CityInfo info={popupInfo} />\n        </Popup>\n      )\n    );\n  }\n\n  render() {\n    const {showPopup} = this.state;\n    return (\n      <ReactMapGL\n        ref={(reactMap) => this.reactMap = reactMap}\n        mapStyle=\"mapbox://styles/mapbox/streets-v9\"\n        mapboxApiAccessToken=\"pk.eyJ1IjoieW9tYW40NyIsImEiOiJjampxM2g3YjUyMzFyM3ZvMXNjZ2R3d2ZtIn0.r0zXd8hAqa1haG3lkjlDwA\"\n        onViewportChange={(viewport) => this.setState({ viewport })}>\n        {this._renderPopup()}\n      </ReactMapGL>\n    );\n  }\n}\n\nexport default Map;\n"]},"metadata":{},"sourceType":"module"}